# 一种HTTP下实现安全传输的方案



## 一、 预防中间人攻击



### 1.  中间人攻击(Man-in-the-middle Attack)

攻击者在客户端与服务器之间作为**中间人**，对于客户端而言，中间人伪装成服务端，对于服务端而言，中间人伪装成客户端（类似虚拟私人网络[^VPN]的工作原理），所以才诞生了TLS[^TLS]，而HTTPS也正是由HTTP和TLS/SSL协议构造的可进行加密传输与身份验证的网络协议。

```mermaid
graph RL;
	A[Server]-->B[Hacker]
	B-->A
	B-->C[Client]
	C-->B
```

<p style="font-size:12px;color:#555;text-align:center">中间人攻击示意图</p>

传统的HTTP协议不能进行端到端的加密传输与身份验证，因此中间人可以根据窃听到的公钥来伪造信息，且明目张胆地与服务器进行通信。



### 2. 解决方案

上文提到，攻击者模仿用户行为进行通信，HTTP协议对此束手无策。

在此提出两种解决方案：

<a href=#method_1 class=link>1.</a> 使用对称加密对消息进行加密，通信过程中不传输密钥，攻击者不知道密钥，因此无法解密/篡改消息

<a href=#method_2 class=link>2.</a> 使用一种协议，对明文使用公钥进行加密，同时进行身份验证，确保没有中间人。



<h4 id=method_1>方案一、对称加密</h4>

*该方法存在局限性，加密用的密钥必须在安全的环境下进行协商，并且被妥善保存，攻击者不能知道密钥。*

用户在前端手动输入密钥，对明文使用该密钥进行对称加密（加密算法如：DES，AES），需要注意的是，加密操作也在前端完成，随后将密文传输到服务端，服务端应提前保存用户的密钥，并使用对应的密钥进行解密操作。

<h4 id=method_2>方案二、身份验证</h4>

服务端开启http-only策略，同时服务端将用户的IP地址保存在session中，并且给客户端设置一个cookie，该cookie储存了访问服务器的IP地址。客户端获取到cookie之后，将其与客户端的IP地址进行匹配，如果二者不同，则代表用户正在受到中间人攻击。



<style>.link{text-decoration:none;}</style>

[^VPN]: 这里提到的VPN仅对消息进行转发，即使传输过程中使用非对称加密（如RSA），攻击者也可以轻松获取密钥，或篡改明文。
[^TLS]: Transport Layer Security 协议，一种符合工业标准的设计，其目的为确保互联网的通信安全