---
import { ChevronRight } from 'lucide-vue-next'
import type { ClassValue } from 'clsx'
import { Image } from 'astro:assets'
import LinkButton from './ui/button.astro'
import { cn } from '@/theme/lib/utils'
import { type IPostInfo, getTagLink } from '@/theme/lib/post'
import { formatDatetime } from '@/theme/lib/date'

export interface Props {
    info: IPostInfo
    className?: ClassValue
}

const { info, className } = Astro.props

---

<!-- 小于md时显示 -->
<div
  class:list={[
    'md:hidden card bg-base-100 border border-base-300 shadow-sm',
    className,
  ]}
>
{
  info.cover && (
    <a href={info.link} class="bg-black relative group">
        <Image
          {...info.cover}
          src={info.cover}
          alt=""
          loading="lazy"
          class="w-full aspect-video object-cover rounded-t-box hover:opacity-50 hover:blur-sm transition-all"
        />
        <ChevronRight class="opacity-0 text-white group-hover:opacity-100 transition-all pointer-events-none absolute size-20 top-[50%] left-[50%] group-hover:translate-x-[-50%] translate-y-[-50%]" />
    </a>
  )
}
  <div class="card-body py-4 px-5 gap-y-1">
    <h2 class="card-title break-all">
      <a
        href={info.link}
        class="transition group hover:text-primary text-xl md:text-2xl w-full dark:font-bold"
      >
        {info.title}
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="size-5  stroke-primary transition absolute group-hover:translate-x-1 translate-y-1 inline opacity-0 group-hover:opacity-100">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
      </a>
    </h2>

    <!-- tags -->
    <div class="flex items-center h-full gap-x-2 opacity-80">
        {
          info.tags.map(tag => (
            <LinkButton className="p-0 h-full font-normal text-sm hover:text-primary" href={getTagLink(tag)}>
              #{tag}
            </LinkButton>
          ))
        }
    </div>

    <!-- summary -->
    {
      info.description && (
        <p class="break-all text-lg">
          {info.description}
        </p>
      )
    }

    <!-- metadata -->
    <p class="opacity-80 text-sm font-mono">
      {formatDatetime(info.ctime)}
      {' · '}
      {info.reading.words}
      {' '}
      Words ·
      {' '}
      {info.reading.text}
    </p>
  </div>
</div>

<!-- 大于md时显示 -->

<div class="md:block hidden bg-base-100 relative rounded-box border border-base-300">
  <div class="flex items-stretch">
    <div class="flex-1 flex flex-col break-all pb-6 pt-7 px-8 gap-y-5">
      <a
        href={info.link}
        class={cn(
          'transition group hover:text-primary block font-semibold text-xl md:text-2xl w-full',
          'before:absolute before:bg-primary before:h-6 before:opacity-0 hover:before:opacity-100 before:left-[-0.1rem] before:rounded-md before:top-8 before:w-1',
          'dark:font-bold dark:active:text-[var(--title-active)]',
        )}
      >
        {info.title}
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" class="size-5  stroke-primary transition absolute group-hover:translate-x-1 translate-y-1 inline opacity-0 group-hover:opacity-100">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
      </a>

      <!-- tags -->
      <div class="flex items-center gap-x-2 opacity-80">
        {
          info.tags.map(tag => (
            <LinkButton
              className="p-0 h-full font-normal text-sm hover:text-primary"
              href={getTagLink(tag)}
            >
                <>#{tag}</>
            </LinkButton>
          ))
        }
      </div>

      <!-- summary -->
      {
        info.description && (
          <p class="break-all text-lg">
            {info.description}
          </p>
        )
      }

      <!-- metadata -->
      <p class="opacity-80 text-sm font-mono">
        {formatDatetime(info.ctime)}
        {' · '}
        {info.reading.words}
        {' '}
        Words ·
        {' '}
        {info.reading.text}
      </p>
    </div>

    <!-- cover -->
     {
      info.cover && (
        <a href={info.link} class="relative group">
          <figure class="bg-black h-full group-hover:scale-[0.9] transition-all group-hover:rounded-2xl">
            <Image
              {...info.cover}
              src={info.cover}
              alt=""
              loading="lazy"
              class="h-full max-w-64 object-cover rounded-r-box hover:rounded-2xl hover:opacity-50 transition-all"
            />
          </figure>

        <ChevronRight class="opacity-0 text-white group-hover:opacity-100 transition-all pointer-events-none absolute size-20 top-[50%] left-[50%] group-hover:translate-x-[-50%] translate-y-[-50%]" />

        </a>
      )
     }
  </div>
</div>
