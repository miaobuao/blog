---
import type { GetStaticPaths } from 'astro'
import ArticleTimeline from '@/theme/components/ArticleTimeline.astro'
import Footer from '@/theme/components/Footer.astro'
import HomeLayout from '@/theme/layouts/HomeLayout.astro'
import { aggregateByTag, getAllPostsInfo, type IPostInfo } from '@/theme/lib/post'
import { getCollection } from 'astro:content'
import * as R from 'ramda'

export interface Props {
    tag: string
    posts: IPostInfo[]
}

export const getStaticPaths = (async () => {
    const posts = await R.pipe(
        getCollection,
        getAllPostsInfo,
    )('blog')
    const tags = aggregateByTag(posts)
    return Array.from(tags.entries()).map(([tag, posts]) => ({
        params: { slug: tag },
        props: { tag, posts },
    }))
}) satisfies GetStaticPaths


const { tag, posts } = Astro.props
---

<HomeLayout>
    <div class="flex flex-col gap-4 p-2">
        <h1 class="text-3xl font-bold">
            # {tag}
        </h1>
        <ArticleTimeline articles={posts} />
    </div>
    <Footer />
</HomeLayout>
